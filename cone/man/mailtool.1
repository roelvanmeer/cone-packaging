.\"<!-- $Id: book.sgml,v 1.3 2004/05/30 02:43:00 mrsam Exp $ -->
.\"<!-- Copyright 2002-2003 Double Precision, Inc.  See COPYING for -->
.\"<!-- distribution information. -->
.\" This manpage has been automatically generated by docbook2man 
.\" from a DocBook document.  This tool can be found at:
.\" <http://shell.ipoline.com/~elmert/comp/docbook2X/> 
.\" Please send any bug reports, improvements, comments, patches, 
.\" etc. to Steve Cheng <steve@ggi-project.org>.
.TH "MAILTOOL" "1" "10 April 2006" "" ""

.SH NAME
mailtool \- Process mailboxes
.SH SYNOPSIS

\fBmailtool\fR [ \fBoptions\fR\fI ...\fR ]

.SH "USAGE"
.PP
\fBmailtool\fR
is a diagnostic utility for handling various operations on mailboxes.
\fBmailtool\fR\&'s
main uses include: display the list of folders in a mailbox;
displaying list of messages in a mailbox; and
copying mailboxes.
.PP
The following mailboxes can be accessed by
\fBmailtool\fR:
.TP
\fBimap://\fIuserid\fB@\fIserver\fB[/options]\fR
An IMAP account.
\fBmailtool\fR will prompt for the login password.
.TP
\fBimaps://\fIuserid\fB@\fIserver\fB[/options]\fR
An IMAP account accessed via an encrypted SSL connection.
.TP
\fBpop3://\fIuserid\fB@\fIserver\fB[/options]\fR
A POP3 account.
\fBmailtool\fR will prompt for the login password.
.TP
\fBpop3s://\fIuserid\fB@\fIserver\fB[/options]\fR
A POP3 account accessed via an encrypted SSL connection.
.TP
\fBmaildir:\fIpath\fB\fR
A local maildir mailbox.
\fIpath\fR specifies the maildir's location relative to the
home directory (NOT the current directory).
.TP
\fBmbox:\fIpath\fB\fR
Local mbox mail folders.
\fIpath\fR specifies the path to an mbox folder file,
or a directory containing mbox folders, relative to the
home directory (NOT the current directory).
.TP
\fBinbox:\fIpath\fB\fR
Local mbox mail folders, like
``mbox:\fIpath\fR'';
additionally, the system spool mailbox is automatically copied to
\fI$HOME/Inbox\fR, which is accessible as folder
INBOX\&.
.PP
The name of a remote IMAP or POP3 server may be followed by one or more
options that control various settings of the IMAP or POP3 connection:
.TP
\fB/cram\fR
Do not open the account unless the server supports secure password
authentication.
Secure password authentication verifies the account's password using
a challenge/response authentication
mechanism (where the label "cram" comes from).
The actual password is never actually transmitted to the server,
and therefore cannot be intercepted
while in transit over an untrusted network.

Secure password authentication is not supported by all servers.  This
option may not work with some servers.
This option does not enable secure password authentication, it only mandates
its use.
If the server supports secure password authentication, it will be used
even without the /cram option.
Traditional userid/password authentication will be used only if the
server does not implement secure password authentication.
The /cram option makes secure password authentication
mandatory.

The /cram option is marginally
useful even with encrypted server
connections.
The secure password authentication never sends the explicit
password to the server.
Encryption makes it theoretically impossible to recover the password from
an encrypted data connection; but with secure authentication the password
is never sent over the connection in the first place (the password's validity
is certified by exchanging certain mathematical calculations between the
server and the client).
If the server is compromised, the compromised server will not receive the
account password (unless the password is recovered from the server in other
ways).
.TP
\fB/imap\fR
Do not use the SMAP if the server claims the
availability of this experimental mail access protocol, and fall back to
IMAP compatibility mode (this option is meaningful only with
``imap://'' and
``imaps://'' URLs).
.TP
\fB/nossl\fR
Do not upgrade a plain connection to an encrypted one.
This option is primarily used for testing and debugging purposes.
Sometimes this option might be useful with servers that claim to offer
encryption, but are unable to do so when taken up on their offer.
.TP
\fB/novalidate-cert\fR
Do not validate the server's SSL certificate when using an encrypted
connection.
Normally the mail server's SSL certificate must be validate when using an
encrypted connection.
The certificate's name must match the server's name, and the certificate
must be signed by a trusted certificate authority.

The encrypted connection normally
fails if the certificate cannot be validate.
Validation requires that a list of trusted certificate
authorities must be known and configured.
It's simply impossible to know
which certificate authorities are valid without an explicit list of valid,
known,
trusted, certificate authorities.  If a trusted authority
list is not configured, no certificate can be validated.  If the server's
certificate is a self-signed certificate (this is often used for testing
purposes), or if it's not signed by a known authority, the encrypted connection
fails.

This /novalidate-cert option disables certificate
validation.
The encrypted connection will be established even if the server's certificate
would otherwise be rejected.
.sp
.RS
.B "Note:"
This option is applicable even when an encrypted IMAP or POP3 connection
is not explicitly requested.
Many mail servers are capable of automatically upgrading unencrypted
connections to a fully-encrypted connection.
If a mail server claims to be able to use encryption, then there's no reason
not to use it.  The result is that all encryption certification requirements
still apply even when encryption is not explicitly requested.
.RE
.SS "DISPLAYING MAILBOX CONTENTS"

\fBmailtool\fR { \fB-tree\fR | \fB-list\fR } \fB\fIaccount\fB\fR

.PP
-tree shows a hierarchical representation of mail folders
in \fIaccount\fR\&.
-list generates a simple folder listing, one folder name
per line.
-tree shows folder names,
while -list shows the actual mail folder path in
\fIaccount\fR\&.
.PP

.nf
mailtool -tree imap://jsmith@mail.example.com/novalidate-cert/cram
.fi
.SS "CREATING FOLDERS"

\fBmailtool\fR { \fB-create\fR | \fB-createdir\fR } \fB\fIfolder\fB\fR \fB\fIname\fB\fR \fB\fIaccount\fB\fR

.PP
-create creates a new subfolder of
\fIfolder\fR in \fIaccount\fR\&.
The new subfolder's name is \fIname\fR\&.
-createdir creates a new folder directory (a folder that
contains other folders).
.PP

.nf
mailtool -create INBOX.lists announcements maildir:Maildir
.fi
.PP
This command creates a new folder ``announcements'' as a
subfolders of ``INBOX.lists'' in the local maildir.
.SS "DELETING FOLDERS"

\fBmailtool\fR { \fB-delete\fR | \fB-deletedir\fR } \fB\fIfolder\fB\fR \fB\fIaccount\fB\fR

.PP
-delete deletes an existing
\fIfolder\fR in \fIaccount\fR\&.
.PP
-deletedir deletes a folder directory.
.PP

.nf
mailtool -delete INBOX.lists.announcements maildir:Maildir
.fi
.SS "RENAMING FOLDERS"

\fBmailtool\fR \fB-rename\fR \fB\fIoldfolder\fB\fR \fB\fIfolder\fB\fR \fB\fIname\fB\fR \fB\fIaccount\fB\fR

.PP
-renames renames an existing
\fIoldfolder\fR\&.
The folder is renamed as 
\fIname\fR, as a subfolder of
\fIfolder\fR\&.
\fIfolder\fR may be an empty string if the folder should
be moved to the top level of \fIaccount\fR\&'s folder
hierarchy.
.PP

.nf
mailtool -rename INBOX.lists.announcements INBOX.lists Announcements maildir:Maildir
.fi
.PP
The folder ``INBOX.lists.announcements'' is renamed to
``INBOX.lists.Announcements''\&.
This slightly unusual way to rename folder allows folders to be relocated
in the mail \fIaccount\fR\&'s folder hierarchy.
.SS "READING FOLDER'S INDEX"

\fBmailtool\fR \fB-index\fR \fB\fIfolder\fB\fR \fB\fIaccount\fB\fR

.PP
-index downloads and prints a summary of all messages in
\fIfolder\fR, in
\fIaccount\fR\&.
The summary shows the sender's and recipients' address, the message's subject,
and size.
.PP

.nf
mailtool -index INBOX imap://john@mail.example.com/novalidate-cert
.fi
.SS "REMOVING A MESSAGE FROM A FOLDER"

\fBmailtool\fR \fB-remove\fR \fB\fIfolder\fB\fR \fB\fIn\fB\fR \fB\fIaccount\fB\fR

.PP
-remove removes message #\fIn\fR
(ranging from 1 to the number of messages in the folder) in
\fIfolder\fR, in
\fIaccount\fR\&.
The message numbers may be obtained by using
-index\&.
.PP
\fIn\fR may be a comma-separated list of message numbers,
in strictly numerically increasing order. -remove confirms
the list of messages to remove and issues a ``Ready:'' prompt.
Press \fBENTER\fR to remove the messages.
.PP

.nf
mailtool -remove INBOX 28,31 imap://john@mail.example.com/novalidate-cert
.fi
.SS "FILTERING MESSAGES"

\fBmailtool\fR \fB-filter\fR \fB\fIfolder\fB\fR \fB\fIaccount\fB\fR

.PP
-filter
is a combination of
-index and -remove\&.
\fIfolder\fR\&'s index is downloaded, and the summary
of each message is shown, one message at a time.
Each message's summary is followed by a prompt:
``Delete, Skip, or Exit''\&.
Pressing \fBD\fR removes the message,
\fBS\fR leaves the message unchanged, and
\fBE\fR leaves the remaining messages unchanged.
.PP

.nf
mailtool -filter INBOX pop3://john@mail.example.com/novalidate-cert
.fi
.sp
.RS
.B "Note:"
-filter is not meant to be used with large folders.
Unless messages are removed quickly, the connection to the server may be
disconnected for inactivity.
.RE
.SS "COPYING FOLDERS"

\fBmailtool\fR [ \fB-recurse\fR ] \fB-tofolder\fR \fB\fItofolder\fB\fR \fB-copyto\fR \fB\fItoaccount\fB\fR \fB-fromfolder\fR \fB\fIfromfolder\fB\fR \fB\fIfromaccount\fB\fR

.PP
This command copies an entire folder,
fromfolder in
fromaccount to a new folder,
tofolder (which will be created, if necessary)
in toaccount\&.
Optionally, -recurse specifies that all subfolders
of fromfolder should also be copied.
.PP

.nf

mailtool -tofolder INBOX -copyto maildir:Maildir \\
    -fromfolder "INBOX" imap://mbox100@mail.example.com/novalidate-cert

mailtool -recurse -tofolder INBOX.converted_mail \\
    -copyto maildir:Maildir -fromfolder "mail" \\
        imap://mbox100@mail.example.com/novalidate-cert
.fi
.PP
This example first copies the INBOX on the IMAP server to
\fI$HOME/Maildir\fR,
then copies subfolders of ``mail'' on the IMAP server to the
``converted_mail'' subfolder in the maildir.
.PP

.nf
mailtool -tofolder INBOX -copyto maildir:Maildir \\
   -fromfolder "INBOX" inbox:mail

mailtool -recurse -tofolder INBOX.converted_mail \\
    -copyto maildir:Maildir -fromfolder "" mbox:mail
.fi
.PP
This example first copies \fI$HOME/Inbox\fR
(accessed as the INBOX folder in inbox:mail) to
\fI$HOME/Maildir\fR,
then
copies mbox folders from \fI$HOME/mail\fR to the
``converted_mail'' subfolder in the maildir.
.sp
.RS
.B "Note:"
Mail accounts that contain hybrid folders (folders that
contain both messages and subfolders) can only be copied to account types
that also support hybrid folders: either local maildirs, or to remote servers
that support hybrid folders.
.RE
.SH "SEE ALSO"
.PP
\fBcone\fR(1)\&.
